#!/usr/bin/env bash

function setup_util_devel() (
	source "$DOROTHY/sources/bash.bash"

	local options

	# apt/apk/dnf essentials
	if is-system --apt; then
		setup-util-apt --optional "$@"
	fi
	# @todo split this into its own [setup-util-*] command
	if is-system --apk; then
		options=(
			--optional
			--name='APK Essentials'
			"$@"
			APK='ca-certificates'
		)
		setup-util "${options[@]}"
	fi
	# @todo split this into its own [setup-util-*] command
	if is-system --dnf; then
		# fedora, almalinux
		options=(
			--optional
			--name='DNF Essentials'
			"$@"
			DNF='dnf-plugins-core'
		)
		setup-util "${options[@]}"
	fi

	# essentials
	setup-util-coreutils "$@"
	setup-util-moreutils --optional "$@"

	# @todo split all of the below into their own [setup-util-*] commands

	# gcc, etc.
	# https://super-unix.com/unixlinux/the-fedora-equivalent-of-the-debian-build-essential-package/
	# https://stackoverflow.com/a/58680740/130638
	# https://packages.debian.org/sid/amd64/build-essential/filelist (no bins...)
	# https://repology.org/project/build-base/versions
	# https://repology.org/project/base-devel/versions
	# https://madb.mageia.org/package/show/application/0/name/task-c-devel
	options=(
		--optional
		--name='Build Essentials'
		"$@"
		APK='build-base'
		APT='build-essential'
		AUR='base-devel'
		BREW='automake' # other tools are included in the Xcode Command Line Tools
		DNF='make' DNF='automake' DNF='gcc' DNF='gcc-c++' DNF='kernel-devel'
		URPMI='task-c-devel'
		XBPS='base-devel'
		ZYPPER='devel_basis' ZYPPER_TYPE='pattern'
	)
	if is-system --fedora; then
		# https://unix.stackexchange.com/questions/1338/what-is-the-fedora-equivalent-of-the-debian-build-essential-package#comment1543747_796397
		# not available on AlmaLinux
		options+=(DNF='@c-development' DNF='@development-tools')
	elif is-system --almalinux || is-system --openeuler; then
		options+=(DNF_GROUP='Development Tools')
	elif is-system --openmandriva; then
		options+=(DNF='task-devel')
	fi
	setup-util "${options[@]}"

	# others that are necessary
	setup-util-clang --optional "$@"
	setup-util-make --optional "$@"
	setup-util-cmake --optional "$@"
	setup-util-llvm --optional "$@"
	setup-util-pkg-config --optional "$@"
	setup-util-openssl --optional "$@"
	setup-util-libxcrypt --optional "$@"
)

# fire if invoked standalone
if [[ $0 == "${BASH_SOURCE[0]}" ]]; then
	setup_util_devel "$@"
fi
