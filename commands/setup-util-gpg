#!/usr/bin/env bash

# GPG
# https://pkgs.org/download/gnupg
# on brew, `gpg`, `gp2`, and `gnupg` are all the same
# https://packages.debian.org/sid/amd64/gnupg/filelist (no bins)

function setup_util_gpg() (
	source "$DOROTHY/sources/bash.bash"

	# options
	local option_reconfigure='yes'
	__flag --target={option_reconfigure} --name='reconfigure' --affirmative --coerce -- "$@"

	# helpers
	function __reconfigure {
		# if reconfigure is not desired, or if not installed, then don't reconfigure
		if [[ $option_reconfigure == 'no' ]] || __command_missing -- gpg; then
			return 0
		fi

		# Ensure GNUPGHOME physically exists
		fs-mkdir -- "$GNUPGHOME"

		# Ensure there is only GNUPGHOME
		fs-move --symlink -- "$HOME/.gnupg" "$GNUPGHOME" || return

		# Fix permissions
		fs-own --quiet --u --recursive -- "$GNUPGHOME" || return
	}

	# setup
	options=(
		--name='GnuPG'
		--cli='gpg'
		"$@"
		APT='gnupg' # UBUNTU
		AUR='gnupg' # ARCH
		BREW='gnupg'
	)
	setup-util "${options[@]}"

	# finish
	__reconfigure
)

# fire if invoked standalone
if [[ $0 == "${BASH_SOURCE[0]}" ]]; then
	setup_util_gpg "$@"
fi
