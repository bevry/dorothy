#!/usr/bin/env bash

# ssh-askpass
# https://packages.debian.org/sid/amd64/ssh-askpass/filelist (no bins)

# https://repology.org/project/ssh-askpass/versions

function setup_util_ssh_askpass() (
	source "$DOROTHY/sources/bash.bash"

	# setup
	local options=(
		--cli='ssh-askpass'
		"$@"
		APT='ssh-askpass'     # UBUNTU
		AUR='x11-ssh-askpass' # ARCH
	)
	setup-util "${options[@]}"

	# ensure that the target exists, even if a symlink to a platform specific location
	local target='/usr/lib/ssh/ssh-askpass' files=() file
	if is-missing -- "$target"; then
		files=(
			# manjaro/gnome
			'/usr/lib/seahorse/ssh-askpass'
			# arch/gnome
			'/usr/lib/ssh/gnome-ssh-askpass3'
			# arch/minimal/ubuntu 22.04
			'/usr/lib/ssh/x11-ssh-askpass'
		)
		for file in "${files[@]}"; do
			if [[ -x $file ]]; then
				sudo-helper --inherit -- \
					symlink-helper --existing="$file" --symlink="$target"
				break
			fi
		done
	fi
)

# fire if invoked standalone
if [[ $0 == "${BASH_SOURCE[0]}" ]]; then
	setup_util_ssh_askpass "$@"
fi
