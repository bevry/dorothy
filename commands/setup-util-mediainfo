#!/usr/bin/env bash

# https://mediaarea.net
# https://mediaarea.net/en/MediaInfo
# https://mediaarea.net/en/MediaInfo/Download
# https://mediaarea.net/en/MediaInfo/Download/Mac_OS <-- is a .dmg that is then a .pkg that then install the cli
# https://repology.org/project/mediainfo/versions
# https://mediaarea.net/en/Repos

function setup_util_mediainfo() (
	source "$DOROTHY/sources/bash.bash"

	# don't continue unless necessary
	if setup-util "$@" --check --cli='mediainfo'; then
		return 0
	fi

	# handle the repository
	# https://mediaarea.net/en/Repos
	setup-util --optional --quiet --name='MediaInfo APT Repository' "$@" DEB='https://mediaarea.net/repo/deb/repo-mediaarea_1.0-25_all.deb' RPM='https://mediaarea.net/repo/rpm/releases/repo-MediaArea-1.0-25.noarch.rpm'

	# setup
	local arch options=(
		--cli='mediainfo'
		"$@"
		APK='mediainfo' # ALPINE
		APT='mediainfo' # UBUNTU
		AUR='mediainfo' # ARCH
		BREW='media-info'
		EMERGE='media-video/mediainfo' # GENTOO
		FLATPAK_REPO='https://flathub.org/repo/flathub.flatpakrepo'
		FLATPAK='net.mediaarea.MediaInfo'
		NIX='mediainfo'
		RPM='mediainfo'      # FEDORA
		URPMI='mediainfo'    # MAGEIA
		XBPS='mediainfo-cli' # VOID
		ZYPPER='mediainfo'   # SUSE
	)
	arch="$(get-arch)"
	if is-linux; then
		if [[ $arch == 'x64' ]]; then
			options+=(
				SNAP='https://mediaarea.net/download/binary/mediainfo/25.09/mediainfo_25.09_amd64.snap'
			)
			if is-appimage; then
				options+=(
					DOWNLOAD='https://mediaarea.net/download/binary/mediainfo/20.09/mediainfo-20.09.glibc2.3-x86_64.AppImage'
					DOWNLOAD_FILENAME='MediaInfo.appimage'
				)
			fi
		elif [[ $arch == 'x32' ]]; then
			options+=(
				SNAP='https://mediaarea.net/download/binary/mediainfo/25.03/mediainfo_25.03_i386.snap'
			)
			if is-appimage; then
				options+=(
					DOWNLOAD='https://mediaarea.net/download/binary/mediainfo/20.09/mediainfo-20.09.glibc2.3-i686.AppImage'
					DOWNLOAD_FILENAME='MediaInfo.appimage'
				)
			fi
		fi
	fi
	setup-util "${options[@]}"
)

# fire if invoked standalone
if [[ $0 == "${BASH_SOURCE[0]}" ]]; then
	setup_util_mediainfo "$@"
fi
