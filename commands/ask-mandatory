#!/usr/bin/env bash
# don't use strict, as we need exit codes
# strict mode, will cause exit code of 2 to explode and be exited

question="${1:-?"USAGE: ask-mandatory <QUESTION> [an-existing-answer]"}"
result="${2-}"
flags=()
if is-affirmative "${PASS-}"; then
	flags+=('-s')
fi

if is-empty-value "$result"; then
	stderr echo -e "$question"
	while true; do
		read "${flags[@]}" -t 300 -r -p "> " result
		if test "$?" -gt 128; then
			exit 1  # failure
		fi
		if is-value "$result"; then
			break
		fi
	done
fi

echo "$result"
