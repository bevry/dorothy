#!/usr/bin/env bash
source "$DOROTHY/sources/essentials.sh"
source "$DOROTHY/sources/strict.bash"

# Install go if necessary
echo -e "\nEnsuring go is installed..."
env CLI=go \
	SNAP='go' \
	SNAP_CLASSIC='yes' \
	BREW='go' \
	setup-util

# Reload paths
echo -e '\nReload paths to ensure go is detected...'
source "$DOROTHY/sources/paths.sh"

# Helper
function goinstall() {
	for arg in "$@"; do
		# don't fail if one of the packages fails to install
		env NAME="go:$arg" GO="$arg" setup-util go || :
	done
}

# Check
if is-present "${GOPATH-}"; then
	mkdir -p "$GOPATH"
fi

# Check
if is-present "${GO_INSTALL-}"; then
	# Install extensions
	if confirm-positive "\nInstall go packages?"; then
		echo -e '\nInstalling go packages...'
		goinstall "${GO_INSTALL[@]}"
	fi

	# Update All
	if confirm-negative "\nUpdate all go packages?"; then
		go get -u -v all || :
	fi
else
	echo
	echo "No go packages were installed as [GO_INSTALL] was empty."
fi

# Linter
if command-exists gometalinter && confirm-negative "\ngometalinter was found, do you wish to install it completely?"; then
	gometalinter --install || :
fi

echo -e "\nInstalled go successfully. âœ…"
