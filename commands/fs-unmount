#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

# fs unmount that does not fail if already unmounted
if is-mounted --target="$1"; then
	sudo umount --verbose --recursive "$1" || {
		# https://github.com/rfjakob/gocryptfs/issues/459
		stderr what-is-using "$1"
		if confirm-negative "Force unmount?"; then
			sudo umount --verbose --recursive --force "$1"
			return "$?"
		else
			return 1
		fi
	}
else
	sudo umount --verbose --recursive "$1" || :
fi
