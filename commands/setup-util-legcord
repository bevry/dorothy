#!/usr/bin/env bash

# https://github.com/Legcord/Legcord

# https://github.com/Legcord/Legcord/releases
# Legcord-1.1.6-linux-aarch64.rpm
# Legcord-1.1.6-linux-amd64.deb
# Legcord-1.1.6-linux-arm64.AppImage
# Legcord-1.1.6-linux-arm64.deb
# Legcord-1.1.6-linux-arm64.tar.gz
# Legcord-1.1.6-linux-arm64.zip
# Legcord-1.1.6-linux-armv7l.AppImage
# Legcord-1.1.6-linux-armv7l.deb
# Legcord-1.1.6-linux-armv7l.rpm
# Legcord-1.1.6-linux-armv7l.tar.gz
# Legcord-1.1.6-linux-armv7l.zip
# Legcord-1.1.6-linux-x64.tar.gz
# Legcord-1.1.6-linux-x64.zip
# Legcord-1.1.6-linux-x86_64.AppImage
# Legcord-1.1.6-linux-x86_64.rpm
# Legcord-1.1.6-mac-universal.dmg
# Legcord-1.1.6-mac-universal.zip
# Legcord-1.1.6-win-arm64.appx
# Legcord-1.1.6-win-arm64.exe
# Legcord-1.1.6-win-arm64.zip
# Legcord-1.1.6-win-ia32.appx
# Legcord-1.1.6-win-ia32.exe
# Legcord-1.1.6-win-ia32.zip
# Legcord-1.1.6-win-x64.appx
# Legcord-1.1.6-win-x64.exe
# Legcord-1.1.6-win-x64.zip
# Legcord-1.1.6-win.exe
# venmic-arm64.node
# venmic-x64.node

# https://repology.org/project/legcord/versions

function setup_util_legcord() (
	source "$DOROTHY/sources/bash.bash"

	# setup
	local arch options=(
		--name='legcord'
		--app='Legcord' # .desktop
		"$@"
	)
	if __is_windows; then
		options+=(
			SCOOP_BUCKET='extras'
			SCOOP='legcord'
			WINGET='smartfrigde.Legcord'
		)
	else
		# improve performance for detectable utilities with conditional assets
		if setup-util --check --app=Legcord "$@"; then
			return 0
		fi

		# setup
		options+=(
			AUR='legcord'
			CASK='Legcord'
			MACPORTS='legcord'
			NIX='legcord'
			# PACSTALL='legcord-deb'
		)
		local arch
		arch="$(__get_arch)"
		function __get_github_asset_url {
			local suffix="$1" regexp
			regexp="$(echo-escape-regexp -- "$suffix")$" || return $?
			github-download --dry --slug='Legcord/Legcord' --latest --asset-regexp="$regexp" | echo-first-line || return $?
		}
		function __add_download_option {
			local suffix="$1" url
			url="$(__get_github_asset_url "$suffix")" || return $?
			options+=(DOWNLOAD="$url")
		}
		function __add_deb_option {
			local suffix="$1" url
			url="$(__get_github_asset_url "$suffix")" || return $?
			options+=(DEB="$url")
		}
		function __add_rpm_option {
			local suffix="$1" url
			url="$(__get_github_asset_url "$suffix")" || return $?
			options+=(RPM="$url")
		}
		function __add_appimage_option {
			local suffix="$1" url
			url="$(__get_github_asset_url "$suffix")" || return $?
			options+=(
				APPIMAGE="$url"
				APPIMAGE_FILENAME='Legcord.appimage'
			)
		}
		if __is_macos; then
			__add_download_option '-mac-universal.zip' || :
		elif __is_linux; then
			if [[ $arch == 'a64' ]]; then
				__add_deb_option '-linux-arm64.deb' || :
				__add_rpm_option '-linux-aarch64.rpm' || :
				__add_appimage_option '-linux-arm64.AppImage' || :
			elif [[ $arch == 'a32' ]]; then
				__add_deb_option '-linux-armv7l.deb' || :
				__add_rpm_option '-linux-armv7l.rpm' || :
				__add_appimage_option '-linux-armv7l.AppImage' || :
			elif [[ $arch == 'x64' ]]; then
				__add_deb_option '-linux-amd64.deb' || :
				__add_rpm_option '-linux-x86_64.rpm' || :
				__add_appimage_option '-linux-x86_64.AppImage' || :
			fi
		fi
	fi
	setup-util "${options[@]}"
)

# fire if invoked standalone
if [[ $0 == "${BASH_SOURCE[0]}" ]]; then
	setup_util_legcord "$@"
fi
