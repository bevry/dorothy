#!/usr/bin/env bash
# don't use strict, as we need exit codes
# strict mode, will cause exit code of 2 to explode and be exited

question="${1:?"USAGE: ask-confirm <QUESTION> <DEFAULT>"}"
fallback="${2:?"USAGE: ask-confirm <question> <DEFAULT>"}"
flags=()
if is-affirmative "${PASS-}"; then
	flags+=('-s')
fi

stderr echo -e "$question [$fallback]"
read "${flags[@]}" -t 3600 -r -p "> " result
if test "$?" -gt 128; then
	# timeout occured
	if is-value "$result"; then
		echo "$result"
		exit 0
	else
		exit 1  # failure
	fi
fi
if is-empty-value "$result"; then
	echo "$fallback"
else
	echo "$result"
fi
