#!/usr/bin/env swift
import Foundation

let nativeOverrides: [String: String] = [
	// Apparently swift believes Indonesian is natively called "Indonesia" instead of "Bahasa Indonesia"", so correct that
    "id": "Bahasa Indonesia"
]

func usage() {
    print("Usage: get-language <language-code> [language-code ...]")
    print("Example: get-language en id zh")
    exit(22)
}

func processLanguage(_ langCode: String) {
    // Get language name in English
    let englishLocale = Locale(identifier: "en")
    let englishName = englishLocale.localizedString(forLanguageCode: langCode) ?? "Unknown"

    if englishName == "Unknown" {
        fputs("Unknown Language Identifier: \(langCode)\n", stderr)
        exit(22)
    }

    // Get language name in itself, with overrides
    let nativeLocale = Locale(identifier: langCode)
    let defaultNativeName = nativeLocale.localizedString(forLanguageCode: langCode) ?? "Unknown"
    let nativeName = nativeOverrides[langCode] ?? defaultNativeName

    // Output the language name in English and itself: English Name (Native Name)
    if englishName == nativeName {
        print(englishName)
    } else {
        print("\(englishName) (\(nativeName))")
    }
}

// Fetch the arguments into a mutable array type
var args = CommandLine.arguments
// Handle differences in invocaiotions
if args.isEmpty {
	usage()
} else if args[0].hasSuffix("get-language") {
	args = Array(args.dropFirst())
} else if args[0].hasSuffix("/swift-frontend") {
    if let idx = args.firstIndex(of: "--") {
        args = Array(args[(idx + 1)...])
    } else {
		usage()
	}
} else {
	// throw error about unknown invocation
	fputs("Unknown invocation method: \(CommandLine.arguments)\n", stderr)
	exit(22)
}
if args.isEmpty {
    usage()
}
for langCode in args {
    processLanguage(langCode)
}
