#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

function convert {
	local input output
	input="$1"
	output="$(fs-filename "$1")-h264.mp4"
	echo "converting $input to $output"
	ffmpeg -i "$input" -c:v libx264 -c:a libfdk_aac "$output" </dev/null && echo "converted $input to $output" || echo "conversion of $input to $output FAILED"
}

if is-empty-string "${1-}"; then
	find ./*.264 | while read -r file; do
		convert "$file"
	done
else
	convert "$1"
fi
