#!/usr/bin/env bash

# https://github.com/httpie/httpie
# https://httpie.io/docs/cli/installation

# https://github.com/httpie/cli/releases
# httpie-3.2.2.deb

# https://packages.debian.org/sid/amd64/httpie/filelist
# /usr/bin/http
# /usr/bin/httpie
# /usr/bin/https

# Maintained: Last release 2024-11-02
# https://github.com/httpie/httpie
# http [METHOD] URL [REQUEST_ITEM ...]
# --follow, -F                      Follow 30x Location redirects.
# --ignore-stdin, -I                Do not attempt to read stdin
# --output, -o FILE                 Save output to FILE instead of stdout.
#                                   If --download is also set, then only the response body is saved to FILE.
#                                   Other parts of the HTTP exchange are printed to stderr.
# --download, -d                    Do not print the response body to stdout. Rather, download it and store it in a file.
# --output [filename]               This action is similar to the default behaviour of wget.
# --continue, -c                    Resume an interrupted download. Note that the --output option needs to be specified as well.
# --headers, -h                     Print only the response headers.
# --check-status                    By default, HTTPie exits with 0 when no network or other fatal errors occur.
#                                   This flag instructs HTTPie to also check the HTTP status code and exit with an error if the status indicates one.
#                                   When the server replies with a 4xx (Client Error) or 5xx (Server Error) status code, HTTPie exits with 4 or 5 respectively.
#                                   If the response is a 3xx (Redirect) and --follow hasn't been set, then the exit status is 3.
#                                   Also an error message is written to stderr if stdout is redirected.
# --quiet, -q                       Do not print to stdout or stderr, except for errors and warnings when provided once.
#                                   Provide twice to suppress warnings as well.
#                                   Flag doesn't affect behaviour of download beyond not printing to terminal.
# --auth, -a USER[:PASS] | TOKEN    For username/password based authentication mechanisms.

function setup_util_httpie() (
	source "$DOROTHY/sources/bash.bash"

	# improve performance for detectable utilities with conditional assets
	if setup-util --check --cli=http "$@"; then
		return 0
	fi

	# no apk
	local options=(
		--name='HTTPie'
		--cli='http'
		"$@"
		APT='httpie'
		AUR='httpie'
		BREW='httpie'
		EMERGE='httpie'
		EOPKG='httpie'
		PORT='httpie'
		RPM='httpie'
		UV='httpie'
		ZYPPER='httpie'
	)
	setup-util "${options[@]}"
)

# fire if invoked standalone
if [[ $0 == "${BASH_SOURCE[0]}" ]]; then
	setup_util_httpie "$@"
fi
