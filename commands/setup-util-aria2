#!/usr/bin/env bash

# https://github.com/aria2/aria2
# wget alternative

# https://github.com/aria2/aria2/releases
# aria2-1.36.0-aarch64-linux-android-build1.zip
# aria2-1.36.0-win-32bit-build1.zip
# aria2-1.36.0-win-64bit-build1.zip
# aria2-1.36.0.tar.bz2
# aria2-1.36.0.tar.gz
# aria2-1.36.0.tar.xz

# https://packages.debian.org/sid/amd64/aria2/filelist
# /usr/bin/aria2c

# https://repology.org/project/aria2/versions

# aria2c [<OPTIONS>] [<URI>|<MAGNET>|<TORRENT_FILE>|<METALINK_FILE>] ...
# -d, --dir=<DIR>                          The directory to store the downloaded file.
# -o, --out=<FILE>                         The file name of the downloaded file.
#                                          It is always relative to the directory given in --dir option.
#                                          When the --force-sequential option is used, this option is ignored.
# --allow-overwrite [true|FALSE]           Restart download from scratch if the corresponding control file doesn't exist.
#                                          See also --auto-file-renaming option.
# --always-resume [TRUE|false]             Always resume download.
#                                          If true is given, aria2 always tries to resume download and if resume is not possible, aborts download.
#                                          If false is given, aria2 downloads file from scratch. See --max-resume-failure-tries option.
# --auto-file-renaming [TRUE|false]        Rename file name if the same file already exists.
# --download-result=<OPT=default>          This option changes the way Download Results is formatted.
#                                          If OPT is default, print GID, status, average download speed and path/URI.
#                                          If multiple files are involved, path/URI of first requested file is printed and remaining ones are omitted.
#                                          If OPT is full, print GID, status, average download speed, percentage of progress and path/URI.
#                                          The percentage of progress and path/URI are printed for each requested file in each row.
#                                          If OPT is hide, Download Results is hidden.
# --enable-color [TRUE|false]              Enable color output for a terminal.
# -q, --quiet [true|FALSE]                 Make aria2 quiet (no console output).
# -c, --continue [true|false]              Continue downloading a partially downloaded file.
# -m, --max-tries=<N=5>                    Set number of tries. 0 means unlimited. See also --retry-wait.
# --retry-wait=<SEC=0>                     Set the seconds to wait between retries.
#                                          When SEC > 0, aria2 will retry downloads when the HTTP server returns a 503 response.
# --http-user=<USER>                       Set HTTP user. This affects all URIs.
# --http-passwd=<PASSWD>                   Set HTTP password. This affects all URIs.
# --header=<HEADER>                        Append HEADER to HTTP request header. You can use this option repeatedly to specify more than one header.
# --show-console-readout [TRUE|false]      Show console readout.
# --stderr [true|FALSE]                    Redirect all console output that would be otherwise printed in stdout to stderr.
# --summary-interval=<SEC=60>              Set interval in seconds to output download progress summary.  Setting 0 suppresses the output.
# --truncate-console-readout [TRUE|false]  Truncate console readout to fit in a single line.

function setup_util_aria2() (
	source "$DOROTHY/sources/bash.bash"

	# despite docs, no apk
	local options=(
		--cli='aria2c'
		"$@"
		APT='aria2' # UBUNTU
		AUR='aria2' # ARCH
		BREW='aria2'
		NIX='aria2'
		RPM='aria2' # FEDORA
		SCOOP='aria2'
		URPMI='aria2' # MAGEIA
		WINGET='aria2'
		XBPS='aria2'   # VOID
		ZYPPER='aria2' # SUSE
	)
	setup-util "${options[@]}"
)

# fire if invoked standalone
if [[ $0 == "${BASH_SOURCE[0]}" ]]; then
	setup_util_aria2 "$@"
fi
