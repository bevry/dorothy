#!/usr/bin/env bash

# https://github.com/IBM/plex
# https://github.com/IBM/plex/releases

function setup_util_ibm_plex() (
	source "$DOROTHY/sources/bash.bash"

	# improve performance for detectable utilities with conditional assets
	if setup-util "$@" --check --font='IBMPlex*'; then
		return 0
	fi

	# setup
	local options=(
		--name='IBM Plex'
		--font='IBMPlex*'
		"$@"
		# CASK='font-ibm-plex' <-- Deprecated because it is now distributed with the font variants as individual packages! It was disabled on 2025-09-05.
		CASK='font-ibm-plex-mono' CASK='font-ibm-plex-sans' CASK='font-ibm-plex-serif'
	)
	function __get_github_asset_urls {
		github-download --dry --slug='IBM/plex' --tag='@ibm/plex-sans-variable@0.2.0' --asset-filter='^plex-sans-variable\.zip$' || return
		github-download --dry --slug='IBM/plex' --tag='@ibm/plex-serif@1.1.0' --asset-filter='^ibm-plex-serif\.zip$' || return
		github-download --dry --slug='IBM/plex' --tag='@ibm/plex-mono@1.1.0' --asset-filter='^ibm-plex-mono\.zip$' || return
	}
	function __add_download_option {
		local urls
		urls="$(__get_github_asset_urls)" || return
		options+=(
			DOWNLOAD="$urls"
			DOWNLOAD_ARCHIVE_GLOB='**/*.ttf'
		)
	}
	__add_download_option || :
	setup-util "${options[@]}"
)

# fire if invoked standalone
if [[ $0 == "${BASH_SOURCE[0]}" ]]; then
	setup_util_ibm_plex "$@"
fi
