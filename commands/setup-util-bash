#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

# don't specify CLI, as we want to reinstall
env NAME='bash' \
	APK='bash' \
	APT='bash' \
	BREW='bash' \
	PACMAN='bash' \
	PAMAC='bash' \
	YUM='bash' \
	setup-util

# no need to do fancy checks, as there is no failure if it is already present
env NAME='Bash Completions' \
	APK=bash-completion \
	APT=bash-completion \
	BREW=bash-completion \
	PACMAN=bash-completion \
	YUM=bash-completion \
	setup-util

# ensure the login shell is no longer outdated
# shellcheck disable=SC2016
{
	login_shell="${SHELL-}"
	bash_shell="$(which bash)"
	if test -n "$login_shell"; then
		login_shell_name="$(basename "$login_shell")"
		if test "$login_shell_name" = 'bash' -a "$login_shell" != "$bash_shell"; then
			login_shell_version="$("$login_shell" -c -- 'echo $BASH_VERSION')"
			bash_shell_version="$("$bash_shell" -c -- 'echo $BASH_VERSION')"
			if test "$login_shell_version" != "$bash_shell_version"; then
				echo-style --h2="Your login shell is an outdated version of bash."
				echo-style --h2="You will now be prompted now to change it to a more modern shell."
				select-shell
				echo-style --h2="Close this terminal, open a new one, then run the command you ran again."
				exit
			fi
		fi
	fi
}
