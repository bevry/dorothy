#!/usr/bin/env bash

function is_odd_test() (
	source "$DOROTHY/sources/bash.bash"

	eval-tester --name='no args' --status=22 --ignore-stderr -- \
		is-odd --

	eval-tester --name='odd numbers are odd' -- \
		is-odd -- 1 3 5 7 9 11

	eval-tester --name='negative odd numbers are odd' -- \
		is-odd -- -1 -3 -5 -7 -9 -11

	eval-tester --name='even numbers are not odd' --status=1 -- \
		is-odd -- 2

	eval-tester --name='even numbers are not odd' --status=1 -- \
		is-odd -- 2 4

	eval-tester --name='zero is not odd' --status=1 -- \
		is-odd -- 0 -0

	eval-tester --name='decimals are invalid' --status=22 --ignore-stderr -- \
		is-odd -- 1.1

	eval-tester --name='odd then even is standard failure' --status=1 -- \
		is-odd -- 1 2

	eval-tester --name='invalid is invalid failure' --status=22 --ignore-stderr -- \
		is-odd -- 1.1

	eval-tester --name='odd then invalid then even is invalid failure' --status=22 --ignore-stderr -- \
		is-odd -- 1 1.1 2

	eval-tester --name='odd then even then invalid is standard failure' --status=1 --ignore-stderr -- \
		is-odd -- 1 2 1.1

	return 0
)
function is_odd() (
	source "$DOROTHY/sources/bash.bash"

	# =====================================
	# Arguments

	# help
	function help {
		__print_help "$@" <<-EOF || return $?
			ABOUT:
			Checks if the <input> is an odd integer.
			Companion to [is-even]. Equivalent to a [is-odd-integer].

			USAGE:
			is-odd [...options] [--] <input>

			OPTIONS:
			<input>
			    Validate this <input>

			RETURNS:
			[0] if all <input>s are odd integers
			[1] if any <input>s are not odd integers
			[22] if any <input>s are not integers
		EOF
		return 22 # EINVAL 22 Invalid argument
	}

	# process
	local item option_inputs=()
	while [[ $# -ne 0 ]]; do
		item="$1"
		shift
		case "$item" in
		'--help' | '-h') help ;;
		'--')
			option_inputs+=("$@")
			shift $#
			break
			;;
		'--'*) help 'An unrecognised flag was provided: ' --variable-value={item} ;;
		*) option_inputs+=("$item") ;;
		esac
	done

	# verify
	__affirm_length_defined "${#option_inputs[@]}" '<input>' || return $?

	# =====================================
	# Action

	local input
	for input in "${option_inputs[@]}"; do
		__affirm_value_is_integer "$input" '<input>' || return $?
		__is_odd "$input" || return $?
	done
	return 0
)

# fire if invoked standalone
if [[ $0 == "${BASH_SOURCE[0]}" ]]; then
	if [[ $* == '--test' ]]; then
		is_odd_test
	else
		is_odd "$@"
	fi
fi
