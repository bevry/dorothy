#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

remote="$("$DOROTHY/commands/ask" --question='What remote to configure?' --default="${1:-"origin"}" --required)"
protocol="$("$DOROTHY/commands/git-protocol-ask" "${2-}")"

# attempt default, ssh, https
if test "$protocol" = 'ssh'; then
	( "$DOROTHY/commands/silent" "$DOROTHY/commands/is-ssh-working" && \
	"$DOROTHY/commands/git-protocol-apply" "$remote" ssh & \
	"$DOROTHY/commands/silent" "$DOROTHY/commands/is-ssh-working" ) || \
	"$DOROTHY/commands/git-protocol-apply" "$remote" https
else
	"$DOROTHY/commands/git-protocol-apply" "$remote" https
fi

# report
git remote -v
