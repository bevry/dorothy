#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

# help
if is-help "$@"; then
	cat <<-EOF >/dev/stderr
		ABOUT:
		?????
	EOF
	return 22 # Invalid argument
fi

# options
what="$(
	choose-option \
		--question='Which IP do you want?' \
		--filter="${1-}" -- local remote
)"

if test "$what" = 'remote'; then
	# does not take into account cloudflare warp
	# fetch https://ipinfo.io/ip

	# does take into account cloudflare warp
	fetch https://whatmyip.bevry.workers.dev
elif command-exists ip; then
	# dependencies
	source "$DOROTHY/sources/ripgrep.bash"

	# cycle through interfaces
	# shellcheck disable=SC2016
	ip -brief address | rg -o 'UP\s+(.+?)[/ ]' --replace '$1'
elif command-exists ifconfig; then
	# dependencies
	source "$DOROTHY/sources/ripgrep.bash"

	# find
	# shellcheck disable=SC2016
	ifconfig | rg -o 'inet ((192\.168\.|10\.0\.)\d+\.\d+)' --replace '$1'
else
	stderr echo 'unsupported environment'
	exit 1
fi
