#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

# dependencies
env QUIET=y setup-util-ripgrep

# options
file="$1"      # /etc/systemd/resolved.conf
content="$(cat "$file")"
find="$2"      # Domains
pattern="^[#]?$find=.+?\n"
replace="$3"   # Domains=~.

# act, replacing inline
sudo touch "$file"
if rg -q "$pattern" <<< "$content"; then
	(rg --passthru "$pattern" --replace "$replace" <<< "$content") > "$file"
else
	echo -e "$content\n\n$replace" > "$file"
fi
