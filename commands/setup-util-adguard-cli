#!/usr/bin/env bash

# https://adguard.com/en/adguard-linux/overview.html
# https://github.com/AdguardTeam/AdGuardCLI
# https://raw.githubusercontent.com/AdguardTeam/AdGuardCLI/release/install.sh

# https://github.com/AdguardTeam/AdGuardCLI/releases/tag/v1.2.32-release
# adguard-cli-1.2.32-linux-aarch64.tar.gz
# adguard-cli-1.2.32-linux-x86_64.tar.gz
# adguard-cli-1.2.32-macos.tar.gz
# install.sh

function setup_util_adguard_cli() (
	source "$DOROTHY/sources/bash.bash"

	# options
	local option_reconfigure='yes'
	__flag --target={option_reconfigure} --name='reconfigure' --affirmative --coerce -- "$@"

	# helpers
	function __reconfigure {
		# if reconfigure is not desired, or if not installed, then don't reconfigure
		if [[ $option_reconfigure == 'no' ]] || __command_missing -- adguard-cli; then
			return 0
		fi

		# Vivaldi
		setup-util-vivaldi --configure || :
	}

	# improve performance for detectable utilities with conditional assets
	if setup-util --check --cli=adguard-cli "$@"; then
		__reconfigure
		return 0
	fi

	# setup
	local options=(
		--name='AdGuard CLI'
		--cli='adguard-cli'
		"$@"
		INSTALLER='https://raw.githubusercontent.com/AdguardTeam/AdGuardCLI/release/install.sh'
		INSTALLER_UNINSTALL_ARGUMENT='-u'
	)
	setup-util "${options[@]}"
	__reconfigure
)

# fire if invoked standalone
if [[ $0 == "${BASH_SOURCE[0]}" ]]; then
	setup_util_adguard_cli "$@"
fi
