#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

# extract options
if test "$#" -eq 3; then
	if is-value "$3"; then
		# supports the case where the options are squashed together into one argument, yet still maintaining newlines
		mapfile -t options <<<"$3"
	else
		options=()
	fi
else
	# supports the case where each option is its own argument
	options=("${@:3}")
fi

# keep only positive
mapfile -t options <<<"$(echo-values "${options[@]}")"

# check that options were provided
if ! is-values "${options[@]}"; then
	stderr echo "unable to provide you options for the question [$1]"
	exit 1
fi

# check if a default value was provided
if is-value "${2-}"; then
	if ! is-needle "$2" "${options[@]}"; then
		stderr echo "invalid selection [$2], the selection must be one of these:"
		stderr echo-lines "${options[@]}"
		exit 1
	fi
	echo -n "$2"
else
	stderr echo "$1"
	choose "${options[@]}"
fi
