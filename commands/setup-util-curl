#!/usr/bin/env bash

# https://packages.debian.org/sid/amd64/curl/filelist
# /usr/bin/curl

# https://repology.org/project/curl/versions

# curl [options...] <url>
# -f, --fail                       Fail fast with no output on HTTP errors
# --fail-early                     Fail and exit on the first detected transfer error.
#                                  This option does not imply -f, --fail.
# -i, --include                    Include response headers in the output.
# -O, --remote-name                Write output to file named as remote file
# -s, --silent                     Silent or quiet mode. Do not show progress meter or error messages.
#                                  Use -S, --show-error in addition to this option to disable progress meter but still show error messages.
# -u, --user <user:password>       Server user and password
# -v, --verbose                    Makes curl verbose during the operation. Useful for debugging and seeing what's going on "under the hood".
#                                  If you only want HTTP headers in the output, -i, --include or -D, --dump-header might be more suitable options.
# -S, --show-error                 When used with -s, --silent, it makes curl show an error message if it fails.
# -w, --write-out <format>         Make curl display information on stdout after a completed transfer.
# -H, --header <header/@file>      Extra header to include in information sent.
# -L, --location                   Follow redirects. Pair with --max-redirs option which defaults to 50.
# -o, --output <file>              Write output to <file> instead of stdout.
# --no-clobber                     Don't overwrite.
# -m, --max-time <seconds>         Maximum time allowed for the transfer
# -#, --progress-bar               Make curl display transfer progress as a simple progress bar instead of the meter.
# --no-progress-meter              Switch off the progress meter output without muting or otherwise affecting messages.
# --retry-all-errors Retry on any error. This option is used together with --retry.
# --retry-connrefused              In addition to the other conditions, consider ECONNREFUSED as a transient error too for --retry.
#                                  This option is used together with --retry.
# --retry-delay <seconds>          Make curl sleep this amount of time before each retry when a transfer has failed with a transient error (it changes the default backoff time algorithm between retries).
# --retry <num>                    If a transient error is returned when curl tries to perform a transfer, it retries this number of times before giving up. Setting the number to 0 makes curl do no retries (which is the default). Transient error means either: a timeout, an FTP 4xx response code or an HTTP 408, 429, 500, 502, 503 or 504 response code.

function setup_util_curl() (
	source "$DOROTHY/sources/bash.bash"

	# setup
	local options=(
		--cli='curl'
		"$@"
		APK='curl'
		APT='curl'
		AUR='curl'
		BREW='curl'
		EMERGE='net-misc/curl'
		NIX='nixpkgs.curl'
		RPM='curl'
		URPMI='curl'
		WINGET='cURL'
		XBPS='curl'
		ZYPPER='curl'
	)
	setup-util "${options[@]}"
)

# fire if invoked standalone
if [[ $0 == "${BASH_SOURCE[0]}" ]]; then
	setup_util_curl "$@"
fi
