#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"
source "$DOROTHY/sources/arrays.bash"
if test "$ARRAYS" = 'no'; then
	echo "Array support required for: $0 $*" >/dev/stderr
	exit 95 # Operation not supported
fi

# dependencies
source "$DOROTHY/sources/ripgrep.bash"

# prepare
m="$(mount)" # variable used for several things

# shellcheck disable=SC2016
mapfile -t volumes < <(rg '.+ on (.+) \(.+' --replace '$1' <<<"$m")
if is-array-empty "${volumes[@]}"; then
	stderr echo 'No volumes found.'
	exit 1
fi

if is-needle '--remote' "${@:1}"; then

	for volume in "${volumes[@]}"; do
		# shellcheck disable=SC2016
		remote="$(rg '//(.+) on '"$volume"' .+' --replace '$1' <<<"$m" || :)"
		if test -n "$remote"; then
			# shellcheck disable=SC2016
			server="$(rg '(.+)/.+' --replace '$1' <<<"$remote")"
			# shellcheck disable=SC2016
			directory="$(rg '.+(/.+)' --replace '$1' <<<"$remote")"
			echo -e "$volume\t$server\t$directory"
		fi
	done

else
	echo-lines "${volumes[@]}"
fi
