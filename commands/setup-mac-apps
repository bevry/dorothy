#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

if ! confirm-bool $'\nDo you want to be presented with Mac App Store apps to install?'; then
	exit
fi

email=''
function act () {
	if is-value "$email"; then
		mas install "$@"
	else
		email="$(ask-mandatory "The installer requires your Apple App Store email, enter it now.")"
		if is-value "$email"; then
			mas signout
			mas signin --dialog "$email"
			mas install "$@"
		else
			return 1
		fi
	fi
}

# read-choices does not support piping
# as piping messes with tty stdin
# as it tries to pipe it too
fodder="$(read-choices \
	"Which Mac App Store apps would you like to install?" \
	937984704:"Amphetamine" \
	430798174:"HazeOver" \
	441258766:"Magnet" \
	803453959:"Slack" \
	931134707:"Wire" \
	497799835:"XCode")"
mapfile -t choices <<< "$fodder"
if is-array-empty "${choices[@]}"; then
	echo 'No choices selected.'
	exit 0
fi
for choice in "${choices[@]}"; do
	act "$choice"
done
