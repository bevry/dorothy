#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"
source "$DOROTHY/sources/nullglob.bash"
if test "$NULLGLOB" = 'no'; then
	exit 95 # Operation not supported
fi

# perform the act
chmod 700 "$HOME/.ssh"
find "$HOME/.ssh/"*.pub | while read -r f; do
	chmod 600 "$f"
	ok chmod 600 "${f%.pub}"
done

find "$HOME/.ssh/"*.pub | while read -r f; do
	p="${f%.pub}"
	if test -f "$p"; then
		if is-mac; then
			/usr/bin/ssh-add -K "$p"
		else
			ssh-add "$p"
		fi
	fi
done
