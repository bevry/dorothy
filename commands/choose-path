#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"
source "$DOROTHY/sources/splitlines.bash"

# options
path="${1:?"USAGE: choose-path <PATH> [filter]"}"
filter="${2-}"

# act
if test -n "$path"; then
	cd "$path" || exit 1
fi
if test -n "$filter"; then
	# dependencies
	source "$DOROTHY/sources/ripgrep.bash"

	# perform filter
	lines="$(ls -1 | rg --smart-case "$filter")"
else
	lines="$(ls -1)"
fi

if test -z "$lines"; then
	exit 1
fi

select line in $lines; do
	fs-absolute "$line"
	exit "$?"
done
