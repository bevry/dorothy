#!/usr/bin/env bash

function setup_util_python() (
	source "$DOROTHY/sources/bash.bash"
	source "$(type -P setup-util)"

	# helpers
	function __uninstall {
		local options=()
		local -i status=0

		# python2
		# homebrew no longer offers python2, their suggestion is to use pyenv instead
		# despite docs, apk does not offer python or python2
		local options=(
			--optional
			--cli='python2'
			--uninstall
			"$@"
			APT='python2'   # UBUNTU
			AUR='python2'   # ARCH
			RPM='python'    # FEDORA
			ZYPPER='python' # SUSE
		)
		setup-util "${options[@]}" || status=$?

		# python3
		options=(
			--cli='python3'
			--uninstall
			"$@"
			APK='python3' # ALPINE
			APT='python3' # UBUNTU
			AUR='python3' # ARCH
			BREW='python3'
			RPM='python3'    # FEDORA
			ZYPPER='python3' # SUSE
		)
		setup-util "${options[@]}" || status=$?

		# dependencies for linux, not macos
		if __is_linux; then
			options=(
				--optional
				--name='python3-venv'
				--uninstall
				"$@"
				APT='python3-venv'          # UBUNTU
				AUR='python-virtualenv'     # ARCH
				ZYPPER='python3-virtualenv' # SUSE
			)
			setup-util "${options[@]}" || status=$?
		fi

		# @todo consider whether to also call `setup-util-uv --uninstall`

		# return failure status
		return "$status"
	}
	function __install {
		setup-util-uv "$@" || return $?
		uv python install || return $?
	}

	# process
	setup_util --name='Python' "$@" EVAL_UNINSTALL=__uninstall EVAL_INSTALL=__install
)

# fire if invoked standalone
if [[ $0 == "${BASH_SOURCE[0]}" ]]; then
	setup_util_python "$@"
fi
