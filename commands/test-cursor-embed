#!/usr/bin/env bash
source "$DOROTHY/sources/tty.bash"
source "$DOROTHY/sources/strict.bash"

# this example will be removed once the cursor stuff has been committed

mapfile -t yx < <(tty_get_y_x)
# echo "${yx[*]}" > /dev/tty
for (( i=0; i<5; i++)); do
	mapfile -t yx < <(tty_get_y_x)
	echo "${yx[*]}" > /dev/tty
	echo -e "one random number $RANDOM" > /dev/tty
	echo -en "another random number: " > /dev/tty
	echo -e "$RANDOM" > /dev/tty
	# set +e # disable hard fail so we can get the exit code
	# action="$(read-arrow)"; ec="$?"
	# set -e # reenable hard fail
	sleep 1
	# tty_erase_from_y_x "${yx[@]}"
done

echo 'result'


# extract_line () {
# 	exec < /dev/tty
# 	oldstty=$(stty -g)
# 	stty raw -echo min 0
# 	echo -en "\033[6n" > /dev/tty
# 	IFS=';' read -r -d R -a pos
# 	stty "$oldstty"
# 	echo "$((${pos[0]:2} - 2))"
# }

# y="$(extract_line)"

# for (( i=0; i<5; i++)); do
# 	echo -e "a random number is:\n$RANDOM" > /dev/tty
# 	sleep 1
# 	printf "\e[$y;H\e[J" > /dev/tty
# done

# echo 'result'
