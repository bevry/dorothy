#!/usr/bin/env bash

function echo_style_test() (
	source "$DOROTHY/sources/bash.bash"
	eval-tester --ignore-stderr --status=22 -- echo-style --help
)

function echo_style() (
	source "$DOROTHY/sources/bash.bash"

	function __help {
		__print_help "$@" <<-EOF || return $?
			USAGE:
			\`echo-style [...options] [--<style>] [--<style>+<style>] <value> [--<style>=<value>] [--<style>+<style>=<value>]\`

			OPTIONS:
			--no-trail
			    Disables outputting a trailing newline.

			--color | --colors | --colors=yes
			    Enables styles.

			--no-color | --no-colors | --colors=no
			    Disables styles.

			EXAMPLES:
			\`echo-style --bold --blue 'this is bold and blue' 'so is this' --yellow ' but this is bold and yellow'\`
			\`echo-style --background-red+intense-white='this is very bad' --green+bold=' while this is good'\`

			EXPLANATION:
			\`--style=value\` will apply the style only to that value.
			\`--style value value\` will apply the style to all subsequent values, until \`--reset\` is provided.
			\`--blue --bold value\` will make value be blue and bold.

			STYLES:
			Colors: \`black\`, \`red\`, \`green\`, \`yellow\`, \`blue\`, \`magenta\`, \`cyan\`, \`white\`
			Modifiers: \`background_<color>\`, \`intense_<color>\`, \`background_intense_<color>\`
			Modifier aliases: \`-<color>\`, \`fg-<color>\`
			Modes: \`reset\`, \`bold\`, \`dim\`, \`underline\`, \`blink\`, \`invert\`
			Targets: \`multicolor\`, \`monocolor\`, \`stdout\`, \`stderr\`, \`tty\`
			Special: \`h1\`, \`e1\`, \`g1\`, \`header\`, \`error\`
			For all styles, refer to \`$DOROTHY/sources/styles.bash\`

			TIPS:
			\`-n\` at the start to avoid printing the trailing newline
			\`--newline\` for a newline
			\`--h1=<value>\` for segment headers
			\`--e1=<value>\` for segment failure footers
			\`--g1=<value>\` for segment success footers
			\`--error=<value>\` for unexpected errors

			QUIRKS:
			Hyphens \`-\` in style names are converted to underscores \`_\`.

			If \`env COLOR=no\`, \`--no-color[s]/--color[s]=no\` then styles will be omitted.

			Use \`--multicolor=<value>\` to indicate the value should only be outputted if colors are.
			Use \`--monocolor=<value>\` to indicate the value should only be outputted if colors are not.
			E.g. \`echo-style --bold='first' --monocolor=' ' --multicolor+dim=' → ' --bold='second'\`
			     Outputs with colors: \`first → second\`
			E.g. \`env COLOR=no echo-style --bold='first' --monocolor=' ' --multicolor+dim=' → ' --bold='second'\`
			     Outputs without colors: \`first second\`
		EOF
		return 22 # EINVAL 22 Invalid argument
	}

	if [[ $* == '--help' ]]; then
		__help || return $?
	else
		__print_style "$@" || return $?
	fi
)

# fire if invoked standalone
if [[ $0 == "${BASH_SOURCE[0]}" ]]; then
	if [[ $* == '--test' ]]; then
		echo_style_test
	else
		echo_style "$@"
	fi
fi
