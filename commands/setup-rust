#!/usr/bin/env bash
source "$DOROTHY/sources/essentials.sh"
source "$DOROTHY/sources/strict.bash"

# remove brew's installer
if is-brew; then
	ok brew uninstall rustup
fi

# use built in installer
if command-exists rustup; then
	rustup update
else
	# https://rust-lang.github.io/rustup/installation/other.html
	curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- --no-modify-path
fi

function act {
	for line in "$@"; do
		if test -n "$line"; then
			# support args
			IFS=" " read -r -a args <<< "$line"
			cargo install "${args[@]}"
		fi
	done
}

if is-present "${RUST_INSTALL-}"; then
	echo -e '\nInstalling rust crates to cargo'
	act "${RUST_INSTALL[@]}"
fi
