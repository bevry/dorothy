#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"
source "$DOROTHY/sources/globstar.bash"
source "$DOROTHY/sources/nullglob.bash"
if test "$NULLGLOB" = 'no' -o "$GLOBSTAR" = 'no'; then
	exit 95 # Operation not supported
fi

# perform the act
cd "$DOROTHY" || exit 2 # No such file or directory

# user/secrets may need sudo
echo-bold 'correcting permissions...'
timeout 60s chmod-partial +rw-x -- ./**/*.*
timeout 60s chmod-partial +rwx  -- ./**/commands/*

echo-bold 'staging new files...'
# The following paths are ignored by one of your .gitignore files: ...
# hint: Use -f if you really want to add them.
# hint: Turn this message off by running
# hint: "git config advice.addIgnoredFile false"
ok silent git add --ignore-errors ./**

echo-bold 'staging changed files...'
ok git add -u

echo-bold 'removing junk...'
rm-junk
