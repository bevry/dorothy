#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

# options
mapfile -t permissions < <(echo-before-separator "$@")
mapfile -t paths < <(echo-after-separator "$@")

if is-array-empty-or-partial "${permissions[@]}" || is-array-empty-or-partial "${paths[@]}"; then
	stderr echo "USAGE:"
	stderr echo "chmod-partial <permissions> -- <paths...>"
	stderr echo ""
	stderr echo "EXAPLE:"
	stderr echo "chmod-partial +x -- path path path"
	exit 1
fi

for path in "${paths[@]}"; do
	chmod --changes --recursive "${permissions[@]}" "$path" || echo "unable to ${permissions[*]}: $path"
done
