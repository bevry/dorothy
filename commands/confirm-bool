#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

# 0=yes
# 1=no

function confirmer() {
	# prompt the user
	read -r -n 1 -p "$1 (y/n) " answer

	# check for strange answers
	if test "$answer" = $'\x1b'; then
		# escape key should equal no
		return 1
	elif test "$answer" = ''; then
		# no answer / enter key
		confirmer "$1"
		return "$?"
	fi

	# check their answer
	"$DOROTHY/commands/is-affirmative" "$answer" || :
	ec="$?"

	# check if indeterminate, if so, ask again
	if test "$ec" -eq 2; then
		confirmer "$1"
		return "$?"
	fi

	# return if determinate
	return "$ec"
}

# confirm with the user
confirmer "$1"
exit "$?"  # unsure if this is necessary
