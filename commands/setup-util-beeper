#!/usr/bin/env bash

# https://www.beeper.com/download

# https://repology.org/project/beeper/versions

function setup_util_beeper() (
	source "$DOROTHY/sources/bash.bash"

	# setup
	local options=(
		--name='Beeper'
		--app='Beeper'      # macos, appimage
		--app='beepertexts' # .desktop
		"$@"
	)
	if __is_windows; then
		options+=(
			WINGET='Beeper.Beeper'
		)
	else
		# setup
		options+=(
			AUR='beeper-v4-bin'
			CASK='beeper'
			EMERGE='net-im/beeper'
		)
		function __add_download_option {
			local url="$1"
			options+=(DOWNLOAD="$url")
		}
		function __add_download_appimage_option {
			local url="$1"
			options+=(
				DOWNLOAD="$url"
				DOWNLOAD_FILENAME='Beeper.appimage'
			)
		}
		if __is_macos; then
			__add_download_option 'https://api.beeper.com/desktop/download/macos/x64/stable/com.automattic.beeper.desktop' || :
		elif __is_linux; then
			local arch
			arch="$(__get_arch)"
			if [[ $arch == 'a64' ]]; then
				__add_download_appimage_option 'https://api.beeper.com/desktop/download/linux/arm64/stable/com.automattic.beeper.desktop' || :
			elif [[ $arch == 'x64' ]]; then
				__add_download_appimage_option 'https://api.beeper.com/desktop/download/linux/x64/stable/com.automattic.beeper.desktop' || :
			fi
		fi
	fi
	setup-util "${options[@]}"
)

# fire if invoked standalone
if [[ $0 == "${BASH_SOURCE[0]}" ]]; then
	setup_util_beeper "$@"
fi
