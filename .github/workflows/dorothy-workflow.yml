name: dorothy-workflow
'on':
  - push
  - pull_request
concurrency:
  group: ${{ github.ref }}
  cancel-in-progress: true
jobs:
  homebrew-macos-checks:
    runs-on: macos-latest
    steps:
      - name: 'Nu + Dorothy Install'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # prevent rate limiting
        shell: bash
        run: |
          # install nu so is available to dorothy's install configuration
          brew install nushell
          # ensure dorothy is cloned, and run command
          bash -c "$(curl -fsSL 'https://dorothy.bevry.me/install?branch=${{ github.ref_name }}&commit=${{ github.sha }}')"
      - name: 'Dorothy Login Shell: nu'
        shell: env RUST_BACKTRACE=1 nu -l --log-level trace -e {0}
        run: |
          command-exists dorothy
          echo-style --success='ok'
          exit
