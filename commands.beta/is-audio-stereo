#!/usr/bin/env bash

function is_audio_stereo_test() (
	source "$DOROTHY/sources/bash.bash"
	eval-tester --ignore-stderr --status=22 -- is-audio-stereo --help
)

function is_audio_stereo() (
	source "$DOROTHY/sources/bash.bash"

	# =================================
	# Arguments

	function help {
		__print_help "$@" <<-EOF || return $?
			ABOUT:
			Check if the audio file at <input> is stereo.

			USAGE:
			\`is-audio-stereo [--] ...<input>\`

			ARGUMENTS:
			<input>
			    The path to the audio file to check.

			RETURN:
			[0] if the audio is stereo
			[1] if the audio is not stereo
		EOF
		return 22 # EINVAL 22 Invalid argument
	}

	# process
	local item option_paths=()
	while [[ $# -ne 0 ]]; do
		item="$1"
		shift
		case "$item" in
		'--help' | '-h') help ;;
		'--')
			option_paths+=("$@")
			shift "$#"
			break
			;;
		'--'*) help 'An unrecognised flag was provided: ' --variable-value={item} ;;
		*) option_paths+=("$item") ;;
		esac
	done

	# assert input
	if [[ ${#option_paths[@]} -eq 0 ]]; then
		help 'No <input>s provided.'
	fi

	# =====================================
	# Action

	local path
	for path in "${option_paths[@]}"; do
		ffprobe -i "$path" 2>&1 | grep --quiet --fixed-strings stereo || return $?
	done
)

# fire if invoked standalone
if [[ $0 == "${BASH_SOURCE[0]}" ]]; then
	is_audio_stereo "$@"
fi
